<!DOCTYPE html>
<html lang="lv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALT Teksta Pārbaudītājs</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <h1>ALT Teksta Pārbaudītājs</h1>
      <p class="description">
        Ievadiet tīmekļa lapas URL, lai analizētu attēlu ALT tekstus.
      </p>

      <form method="POST" action="/" id="url-form">
        <label for="url">Tīmekļa lapas URL:</label>
        <input
          type="url"
          id="url"
          name="url"
          required
          size="50"
          value="{{ submitted_url }}"
          placeholder="piem., https://www.example.com"
        />
        <button type="submit">Analizēt</button>
      </form>

      <div
        id="loading-indicator"
        class="loading-indicator"
        style="display: none"
      >
        Notiek analīze, lūdzu uzgaidiet... ⏳
      </div>

      {% if error %}
      <div class="error-message">{{ error }}</div>
      {% endif %}

      <hr />

      {% if results is not none and not error %}
      <div class="results-summary">
        <h2>Analīzes Kopsavilkums:</h2>
        {% set total_images = results|length %} {% set issues_count = results |
        selectattr('suggestions', '>', []) | list | length %} {% set
        missing_alt_count = results | selectattr('analysis.exists', 'equalto',
        false) | list | length %}

        <p>Kopā atrasti attēli: <strong>{{ total_images }}</strong></p>
        <p>
          Attēli ar ieteikumiem:
          <strong>{{ issues_count }}</strong>
        </p>
        <p>Attēli bez ALT atribūta: <strong>{{ missing_alt_count }}</strong></p>
      </div>

      <h2>Detalizēti Rezultāti:</h2>
      {% if results %}
      <ul class="results-list">
        {% for image in results %}
        <li>
          <img
            src="{{ image.src if image.src else url_for('static', filename='placeholder.png') }}"
            alt="Pārbaudāmā attēla sīktēls"
            loading="lazy"
            onerror="this.onerror=null; this.src='{{ url_for('static', filename='placeholder.png') }}'; this.alt='Neizdevās ielādēt sīktēlu';"
          />
          <div class="image-details">
            <strong>Attēls (src):</strong>
            {% if image.src %}
            <a href="{{ image.src }}" target="_blank" rel="noopener noreferrer"
              >{{ image.src }}</a
            >
            {% else %}
            <span style="color: red">[SRC TRŪKST VAI NAV NORĀDĪTS]</span>
            {% endif %}
            <br />

            <strong>ALT teksts:</strong>
            {% if not image.analysis.exists %}
            <span class="alt-text-display alt-missing"
              >[TRŪKST ALT ATRIBŪTA]</span
            >
            {% elif image.analysis.is_empty %}
            <span class="alt-text-display alt-empty">[TUKŠS (alt="")]</span>
            {% else %}
            <span class="alt-text-display">"{{ image.alt }}"</span>
            {% endif %} {% if image.suggestions %}
            <ul class="suggestions">
              {% for suggestion in image.suggestions %}
              <li>{{ suggestion }}</li>
              {% endfor %}
            </ul>
            {% elif image.analysis.exists and not image.analysis.is_empty %}
            <span class="status-ok">Nav acīmredzamu problēmu.</span>
            {% endif %}
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>
        Analīze pabeigta. Šajā lapā netika atrasti
        <code>&lt;img&gt;</code> tagi.
      </p>
      {% endif %} {% elif request.method == 'POST' and not error %}
      <p>
        Analīze pabeigta. Dotajā URL netika atrasti
        <code>&lt;img&gt;</code> tagi vai radās cita problēma.
      </p>
      {% endif %}
    </div>

    <script>
      // Vienkāršs skripts ielādes indikatora parādīšanai
      const urlForm = document.getElementById("url-form");
      const loadingIndicator = document.getElementById("loading-indicator");
      const urlInput = document.getElementById("url");

      if (urlForm && loadingIndicator && urlInput) {
        urlForm.addEventListener("submit", function (event) {
          if (urlInput.value.trim() !== "") {
            loadingIndicator.style.display = "block";
          } else {
            loadingIndicator.style.display = "none";
          }
        });
      }

      window.addEventListener("pageshow", function (event) {
        if (loadingIndicator) {
          loadingIndicator.style.display = "none";
        }
      });
    </script>
  </body>
</html>
